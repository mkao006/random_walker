{% load staticfiles %}

<!DOCTYPE html>
<html>
  <head>
    <title> Random Walker Prototype </title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">

    <style>
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      #map {
        float:left;
        height: 320px;
        width: 640px;
        display: inline;
      }
      #mapProb {
        float: right;
        display:inline;
        height: 320px;
        width: 640px;
      }
    </style>
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>
    <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="{% static 'generateNewDestination/js_script/initialise.js' %}"></script>
    <script src="{% static 'generateNewDestination/js_script/csrf.js' %}"></script>
    <script src="{% static 'generateNewDestination/js_script/calculateZoom.js' %}"></script>
    <script src="{% static 'generateNewDestination/js_script/getIsWater.js' %}"></script>
    <script src="{% static 'generateNewDestination/js_script/addMarker.js' %}"></script>

    <script type="text/javascript">
      google.maps.event.addDomListener(window, "load", initialise);
    </script>

    <script type="text/javascript">
      $(function() {
          $("#newLocationButton").click(function() {
              console.log(map.getBounds().getNorthEast())
              $.ajax({
                  url: "{% url 'generateNewDestination:newDestination' %}",
                  type: "post",
                  dataType: "json",
                  // Therse is a problem passing float!
                  data: JSON.stringify({'lat': parseFloat(map.getCenter().lat()),
                         'lng': parseFloat(map.getCenter().lng()),
                         'zoom': map.getZoom(),
                         'boundne': map.getBounds().getNorthEast(),
                         'boundsw': map.getBounds().getSouthWest()}),
                  success: function(data){
                      document.getElementById("new_location").innerHTML = 
                          "New Location is at [" + data[0] + ", " + data[1] + "]"
      		      newDestination = new google.maps.LatLng(parseFloat(data[0]), 
                                                              parseFloat(data[1]))
                      //marker.setMap(newDestination)
                      addMarker(newDestination)
                      mapProb = document.getElementById("mapProb")
                      $("#mapProb").attr("src", mapProb.src + "?_=" + new Date().getTime());
                  },
                  fail: function(data){
                      alert("failed")
                  }
               })
         })
      })
    </script>
    <script type="text/javascript">
    $(function() {
        $("#resetLocations").click(function(){
	    $.ajax({
	        url: "{%url 'generateNewDestination:resetPreviousLocations' %}",
	        type: "get",
	        success: function(data){
                    console.log(data)
	        },
	        fail: function(data){
		    console.log(data)
	        }
	    })
        })
    })
    </script>
  </head>
  <body>
    <button type="button" id="newLocationButton">Give Me A New Location!</button>
    <button type="button" id="resetLocations"> Reset Previous Locations</button>
    <!-- <button type="button" id="isWaterButton"> Get feasible layer! </button> -->
    <!-- <button type="button" id="test" onClick="test();;"> Test button </button> -->
    <p id="new_location"> Unknown </p>
    <div id="map"></div> 
    <img id="mapProb" src="{% static 'generateNewDestination/media/samplingProb.png' %}">
    </div>

  </body>
</html>

